<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Delivery IRL — Симулятор Курьера</title>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&apikey=99836553-15c4-4c1f-b8ef-791b2d40a781"
        type="text/javascript"></script>
    <style>
        body,
        html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
        }

        #pano {
            width: 100%;
            height: 100%;
            background-color: #222;
        }

        #ui-overlay {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 280px;
            background: rgba(20, 20, 20, 0.9);
            border: 2px solid #ffcc00;
            border-radius: 15px;
            padding: 15px;
            color: white;
            z-index: 1000;
        }

        .cash {
            color: #00ff00;
            font-weight: bold;
            font-size: 1.2em;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #ffcc00;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        button:disabled {
            background: #555;
        }

        .photo-box {
            width: 100%;
            height: 120px;
            background: #333;
            border-radius: 8px;
            margin: 10px 0;
            overflow: hidden;
            border: 1px solid #555;
        }

        .photo-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>

<body>

    <div id="pano"></div>

    <div id="ui-overlay">
        <div class="stats">Баланс: <span class="cash"><span id="balance">0</span> ₽</span></div>
        <div id="order-screen" style="display:none;">
            <div id="task-text">Дойди до подъезда:</div>
            <div class="photo-box" id="photo-target"></div>
            <div id="dist-info" style="font-size: 0.8em; color: #aaa;">Расстояние: -- м</div>
            <button id="deliver-btn" onclick="finishOrder()" disabled>ЗАВЕРШИТЬ</button>
        </div>
        <button id="start-btn" onclick="takeOrder()">ВЗЯТЬ ЗАКАЗ</button>
    </div>

    <script type="text/javascript">
        let panoramaPlayer;
        let balance = 0;
        let targetCoords = null;
        const staticApiKey = 'ТВОЙ_STATIC_API_КЛЮЧ'; // ВСТАВЬ ТУТ STATIC API КЛЮЧ

        ymaps.ready(function () {
            const startPos = [59.939095, 30.315868];
            ymaps.panorama.locate(startPos).done(function (panoramas) {
                if (panoramas.length > 0) {
                    panoramaPlayer = new ymaps.panorama.Player('pano', panoramas[0]);
                    // Следим за каждым шагом игрока
                    panoramaPlayer.events.add('panoramachange', checkDistance);
                }
            });
        });

        function takeOrder() {
            // Генерация точки в радиусе 100-200 метров
            const currentPos = panoramaPlayer.getPanorama().getPosition();
            targetCoords = [
                currentPos[0] + (Math.random() - 0.5) * 0.002,
                currentPos[1] + (Math.random() - 0.5) * 0.002
            ];

            // Фотка "подъезда" через Static API (вид сверху как ориентир)
            const imgUrl = `https://static-maps.yandex.ru/v1?ll=${targetCoords[1]},${targetCoords[0]}&z=19&l=sat&apikey=${staticApiKey}`;
            document.getElementById('photo-target').innerHTML = `<img src="${imgUrl}">`;

            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('order-screen').style.display = 'block';
            checkDistance();
        }

        function checkDistance() {
            if (!targetCoords) return;
            const currentPos = panoramaPlayer.getPanorama().getPosition();

            // Считаем расстояние (упрощенно)
            const dist = Math.sqrt(Math.pow(currentPos[0] - targetCoords[0], 2) + Math.pow(currentPos[1] - targetCoords[1], 2)) * 111300;

            document.getElementById('dist-info').innerText = `Расстояние: ${Math.round(dist)} м`;

            if (dist < 15) { // Если подошел ближе чем на 15 метров
                document.getElementById('deliver-btn').disabled = false;
                document.getElementById('deliver-btn').style.background = '#00ff00';
            } else {
                document.getElementById('deliver-btn').disabled = true;
                document.getElementById('deliver-btn').style.background = '#ffcc00';
            }
        }

        function finishOrder() {
            balance += 500;
            document.getElementById('balance').innerText = balance;
            alert('Заказ доставлен! +500₽');

            targetCoords = null;
            document.getElementById('start-btn').style.display = 'block';
            document.getElementById('order-screen').style.display = 'none';
        }
    </script>
</body>

</html>